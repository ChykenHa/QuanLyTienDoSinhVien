@page
@model QuanLyTienDoSinhVien.Pages.Student.DashboardModel
@{
    ViewData["Title"] = "Dashboard - Sinh viên";
    Layout = "~/Pages/Shared/_MainLayout.cshtml";
}

@section Sidebar {
    <ul class="sidebar-menu">
        <li class="menu-item">
            <a href="/Student/Dashboard" class="menu-link active">
                <i class="fas fa-home menu-icon"></i>
                <span class="menu-text">Menu</span>
            </a>
        </li>
        <li class="menu-item">
            <a href="/Student/Profile" class="menu-link">
                <i class="fas fa-user menu-icon"></i>
                <span class="menu-text">Sinh viên</span>
            </a>
        </li>
        <li class="menu-item">
            <a href="/Student/StudyPlan" class="menu-link">
                <i class="fas fa-book menu-icon"></i>
                <span class="menu-text">Kế hoạch học tập</span>
            </a>
        </li>
        <li class="menu-item">
            <a href="/Student/Progress" class="menu-link">
                <i class="fas fa-chart-line menu-icon"></i>
                <span class="menu-text">Tiến độ học tập</span>
            </a>
        </li>
        <li class="menu-item">
            <a href="/Student/Schedule" class="menu-link">
                <i class="fas fa-calendar menu-icon"></i>
                <span class="menu-text">Lịch trình</span>
            </a>
        </li>
        <li class="menu-item">
            <a href="/Auth/Logout" class="menu-link">
                <i class="fas fa-sign-out-alt menu-icon"></i>
                <span class="menu-text">Đăng xuất</span>
            </a>
        </li>
    </ul>
}

<div class="page-header">
    <h2>Tổng quan thống kê</h2>
    <p class="text-muted">Theo dõi tiến độ sinh viên và chỉ số khoa.</p>
</div>

<!-- Statistics Cards -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-header">
            <span class="stat-title"><i class="fas fa-star"></i> GPA Trung bình</span>
            <div class="stat-icon blue">
                <i class="fas fa-graduation-cap"></i>
            </div>
        </div>
        <div class="stat-value">@Model.GPA.ToString("0.00")</div>
        <div class="stat-footer">
            <span class="stat-change positive">
                <i class="fas fa-arrow-up"></i> +0.15%
            </span>
            <span class="stat-label">So với kỳ trước</span>
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-header">
            <span class="stat-title"><i class="fas fa-check-circle"></i> Tỷ lệ tốt nghiệp</span>
            <div class="stat-icon green">
                <i class="fas fa-trophy"></i>
            </div>
        </div>
        <div class="stat-value">@Model.CompletionRate%</div>
        <div class="stat-footer">
            <span class="stat-change positive">
                <i class="fas fa-arrow-up"></i> +2.5%
            </span>
            <span class="stat-label">So với năm ngoái</span>
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-header">
            <span class="stat-title"><i class="fas fa-user-check"></i> Tỷ lệ duy trì</span>
            <div class="stat-icon orange">
                <i class="fas fa-users"></i>
            </div>
        </div>
        <div class="stat-value">@Model.RetentionRate%</div>
        <div class="stat-footer">
            <span class="stat-change positive">
                <i class="fas fa-arrow-up"></i> +1.3%
            </span>
            <span class="stat-label">So với khóa trước</span>
        </div>
    </div>
</div>

<!-- Study Progress -->
<div class="content-card">
    <div class="card-header">
        <h3 class="card-title">Tiến độ học tập</h3>
        <div class="card-actions">
            <select class="form-select form-select-sm">
                <option>Học kỳ này</option>
                <option>Học kỳ trước</option>
                <option>Cả năm</option>
            </select>
        </div>
    </div>
    <div class="table-responsive">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Môn học</th>
                    <th>Mã môn</th>
                    <th>Tín chỉ</th>
                    <th>Tiến độ</th>
                    <th>Điểm</th>
                    <th>Trạng thái</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var enrollment in Model.Enrollments)
                {
                    <tr>
                        <td>@enrollment.Subject.Name</td>
                        <td>@enrollment.Subject.Code</td>
                        <td>@enrollment.Subject.Credit</td>
                        <td>
                            @{
                                var progress = enrollment.StudyProgresses.FirstOrDefault();
                                var completionPercent = progress?.CompletionPercent ?? 0;
                            }
                            <div class="progress" style="height: 8px;">
                                <div class="progress-bar bg-primary" role="progressbar" 
                                     style="width: @completionPercent%" 
                                     aria-valuenow="@completionPercent" 
                                     aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                            <small class="text-muted">@completionPercent%</small>
                        </td>
                        <td>@(progress?.Score?.ToString("0.0") ?? "-")</td>
                        <td>
                            @if (enrollment.Status == "Completed")
                            {
                                <span class="badge badge-success">Hoàn thành</span>
                            }
                            else if (enrollment.Status == "In Progress")
                            {
                                <span class="badge badge-info">Đang học</span>
                            }
                            else
                            {
                                <span class="badge badge-warning">Chưa bắt đầu</span>
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<!-- Study Plan Status -->
<div class="content-card">
    <div class="card-header">
        <h3 class="card-title">Kế hoạch học tập</h3>
        <div class="card-actions">
            <a href="/Student/StudyPlan" class="btn btn-primary btn-sm">
                <i class="fas fa-plus"></i> Tạo kế hoạch mới
            </a>
        </div>
    </div>
    <div class="table-responsive">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Kế hoạch</th>
                    <th>Ngày tạo</th>
                    <th>Trạng thái</th>
                    <th>Phản hồi</th>
                    <th>Hành động</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var plan in Model.StudyPlans)
                {
                    <tr>
                        <td>Kế hoạch #@plan.Id</td>
                        <td>@plan.CreatedAt?.ToString("dd/MM/yyyy")</td>
                        <td>
                            @if (plan.Status == "Approved")
                            {
                                <span class="badge badge-success">Đã duyệt</span>
                            }
                            else if (plan.Status == "Pending")
                            {
                                <span class="badge badge-warning">Chờ duyệt</span>
                            }
                            else
                            {
                                <span class="badge badge-danger">Từ chối</span>
                            }
                        </td>
                        <td>
                            @if (plan.StudyPlanReviews.Any())
                            {
                                <span>@plan.StudyPlanReviews.First().Comment</span>
                            }
                            else
                            {
                                <span class="text-muted">Chưa có phản hồi</span>
                            }
                        </td>
                        <td>
                            <a href="/Student/StudyPlan/Details?id=@plan.Id" class="btn btn-sm btn-outline">
                                <i class="fas fa-eye"></i> Xem
                            </a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

@section Scripts {
    <script>
        // Add any dashboard-specific JavaScript here
    </script>
}
